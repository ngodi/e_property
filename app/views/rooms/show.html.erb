<div class="panel panel-default">
    <div class="panel-body">
        <div class="row">
            <div class="col-md-12">
                <%= image_tag @images[0], width: "100%", height: "500px" if @images.length > 0 %>
            </div>
        </div>
        <br>
        <!-- Reviews section -->
        <div class="row">
            <div class="col-md-12">
                <h3>Reviews <span id="average_rating"></span>(<%= @reviews.count %>)</h3>
                <div>
                    <div>
                        <%= render 'reviews/form' if @booked && !@hasReview %>
                    </div>
                     <div>
                        <%= render 'reviews/list' %>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-7 col-md-offset-1">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <%= image_tag avatar_url(@room.user), class: "img-circle avatar-large" %>
                        <%= @room.user.fullname %>
                        <% if current_user && @room.user != current_user %>
                            <div>
                                <%= link_to "Send Message", conversations_path(sender_id: current_user.id, recipient_id: @room.user.id), class: "btn btn-primary", method: 'post' %>
                            </div>
                        <% end %>
                        <%= link_to "View Profile", user_path(@room.user), class: "btn btn-primary btn-block" %>
                    </div>

                    <div class="col-md-9">
                        <h4><%= @room.listing_name %></h4>
                        <%= @room.address %>
                        <br>

                         <div class="row text-center row-space-1">
                            <div class="col-md-3">
                                <i class="fa fa-home fa-2x"></i><br>
                                <%= @room.home_type%>
                            </div>
                            <div class="col-md-3">
                                <i class="fa fa-users fa-2x"></i><br>
                                <%= pluralize(@room.accommodate, "Guest") %>
                            </div>
                            <div class="col-md-3">
                                <i class="fa fa-bed fa-2x"></i><br>
                                <%= pluralize(@room.bed_room, "Bedroom") %>
                            </div>
                            <div class="col-md-3">
                                <i class="fa fa-ship fa-2x"></i><br>
                                <%= pluralize(@room.bath_room, "Bathroom") %>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-10 col-md-offset-1 mx-auto">
                        <h2>About This Listing</h2>
                        <p><%= @room.summary %></p>
                    </div>
                </div>
                <br>
                <div class="row">
                    
                    <div class="col-md-10 col-md-offset-1 mx-auto">
                       <h2>Amenities</h2>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="amenities">
                                    <li class="<%= 'text-line-through' if !@room.is_tv %>">TV</li>
                                    <li class="<%= 'text-line-through' if !@room.is_kitchen %>">Kitchen</li>
                                    <li class="<%= 'text-line-through' if !@room.is_internet %>">Internet</li>
                                </ul>
                            </div>
                             <div class="col-md-6">
                                <li class="<%= 'text-line-through' if !@room.is_heating %>">Heating</li>
                                <li class="<%= 'text-line-through' if !@room.is_air%>">Air Conditioning</li>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="col-md-3">
                <%= render 'reservations/form' %>
            </div>

        </div>

        <div class="row">
            <div class="col-md-10 col-md-offset-1 mx-auto">
                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                    <% if @images %>
                    <ol class="carousel-indicators">
                        <% @images.each do |image| %>
                           <li data-target="#myCarousel" data-slide-to="<%= image.id %>"></li>
                        <% end %>
                    </ol>
                    <% end %>
                <div style="height: 400px" class="carousel-inner" role="listbos">
                  <% if @images %>
                    <% @images.each do |image| %>
                        <div class="item <%= 'active' if image.id == @images[0].id %>">
                            <%= image_tag image %>
                        </div>
                    <% end %>
                  <% end %>
                </div>

                <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                   <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                   <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                   <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                   <span class="sr-only">Next</span>
                </a>
              </div>
            </div>
        </div>
        <br>
        <hr>
        <div class="row">
            <div class="col-md-12">
                <div id="map"></div>
                <style>
                    #map {
                        width: 100%;
                        height: 400px;
                    }
                </style>
                 <script src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.google[:MAP_KEY] %>&callback=initMap&libraries=&v=weekly"
                     async defer 
                    ></script>

                <script>
                  let map;

                    function initMap() {
                    const myLatLng = { lat: <%= @room.latitude %>, lng: <%= @room.longitude %> }
                    map = new google.maps.Map(document.getElementById("map"), {
                        center: myLatLng,
                        zoom: 14,
                        mapTypeId: 'roadmap',
                    });
                    new google.maps.Marker({
                        position: myLatLng,
                        map,
                        label: "H"
                    });
                    }
                </script>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h3 class="text-center">Nearby Listings</h3>
               <% if @room.nearbys %>
                   <% for room in @room.nearbys(10) %>
                    <div class="panel panel-default">
                        <div class="panel-heading"><%= link_to room.listing_name, room_path(room) %></div>
                        <div class="panel-body">
                           <h5> (<%= room.distance.round(2) %>  miles away)</h5>
                           <%= image_tag room.images[0] , width: "250px", height: "250px" %>
                        </div>
                    </div>
                  <% end %>
               <% end %>
            </div>
        </div>
    </div>
</div>
<script>
    $('#average_rating').raty({
        path: '/assets',
        readOnly: true,
        score: <%= @room.average_rating %>
    });
</script>